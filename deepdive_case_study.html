<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Deep Dive Case Studies — Mark Rickey</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400;9..144,600;9..144,700&family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap');

    :root{
      --bg: #07070A;
      --accent: #3b82f6;
      --text: rgba(255,255,255,.92);
      --border: rgba(255,255,255,.10);
      --muted: rgba(255,255,255,.72);
      --muted2: rgba(255,255,255,.60);
      --max: 1100px;

      --font-display: "Fraunces", ui-serif, Georgia, serif;
      --font-body: "Inter", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      --font-mono: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;

      --tracking-tight: -0.02em;
      --tracking-wide: 0.08em;

      /* hover tooltip */
      --tip-bg: rgba(10,10,14,.92);
      --tip-border: rgba(255,255,255,.14);
    }

    *{ box-sizing: border-box; }
    html, body{
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text);
      font-family: var(--font-body);
      overflow-x: hidden;
      text-rendering: geometricPrecision;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    h1,h2,h3{ font-family: var(--font-display); letter-spacing: var(--tracking-tight); }

    /* Page Flip / Scroll Snap Container */
    .snap-container{
      height: 100vh;
      overflow-y: scroll;
      scroll-snap-type: y mandatory;
      scroll-behavior: smooth;
    }

    section{
      height: 100vh;
      width: 100vw;
      scroll-snap-align: start;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      padding: 40px;
      border-bottom: 1px solid var(--border);
    }

    .content-wrap{
      max-width: var(--max);
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 60px;
      align-items: center;
      width: 100%;
    }

    /* Narrative Styling */
    .narrative h2{
      font-size: 48px;
      letter-spacing: -2px;
      margin: 0 0 20px;
      color: #fff;
      line-height: 1.05;
    }
    .narrative p{
      font-size: 18px;
      line-height: 1.6;
      color: rgba(255,255,255,.70);
      margin: 0;
    }

    .badge{
      display: inline-block;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(59,130,246,0.10);
      color: var(--accent);
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: var(--tracking-wide);
      margin-bottom: 15px;
      border: 1px solid rgba(255,255,255,.08);
    }

    .narrative ul{
      color: rgba(255,255,255,0.55);
      font-size: 14px;
      margin-top: 20px;
      line-height: 1.6;
      padding-left: 18px;
    }

    /* Visual Card */
    .visual-stack{
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border);
      border-radius: 24px;
      padding: 34px;
      position: relative;
      min-height: 420px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 18px;
    }

    .stat-row{
      display: flex;
      align-items: baseline;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 2px;
    }

    .number{
      font-family: var(--font-display);
      font-size: 64px;
      font-weight: 700;
      color: var(--accent);
      letter-spacing: var(--tracking-tight);
      font-variant-numeric: tabular-nums;
      line-height: 1;
    }

    .label{
      font-size: 12px;
      color: rgba(255,255,255,.55);
      text-transform: uppercase;
      letter-spacing: var(--tracking-wide);
      font-weight: 700;
      font-family: var(--font-body);
    }

    /* --------- CHARTS (Bar + Ring) --------- */
    .viz-grid{
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 18px;
      margin-top: 6px;
    }

    .viz-card{
      position: relative;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.02);
      border-radius: 18px;
      padding: 16px;
      overflow: hidden;
      transition: transform .25s ease, border-color .25s ease, background .25s ease;
    }
    .viz-card:hover{
      transform: translateY(-2px);
      border-color: rgba(59,130,246,.45);
      background: rgba(59,130,246,.04);
    }

    .viz-title{
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 10px;
    }
    .viz-title .name{
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: var(--tracking-wide);
      color: rgba(255,255,255,.70);
      font-weight: 700;
    }
    .viz-title .meta{
      font-size: 11px;
      color: rgba(255,255,255,.45);
      letter-spacing: 0.02em;
      font-variant-numeric: tabular-nums;
    }

    /* Tooltip */
    .tip{
      position: fixed;
      z-index: 9999;
      pointer-events: none;
      opacity: 0;
      transform: translateY(8px);
      transition: opacity .12s ease, transform .12s ease;
      background: var(--tip-bg);
      border: 1px solid var(--tip-border);
      border-radius: 14px;
      padding: 10px 12px;
      max-width: 280px;
      box-shadow: 0 18px 55px rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
    }
    .tip.show{ opacity: 1; transform: translateY(0); }
    .tip .t-head{
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: var(--tracking-wide);
      color: rgba(255,255,255,.78);
      font-weight: 800;
      margin-bottom: 6px;
    }
    .tip .t-body{
      font-size: 12px;
      color: rgba(255,255,255,.70);
      line-height: 1.45;
    }

    /* Bar chart */
    .bar-chart{
      display: grid;
      gap: 10px;
    }
    .bar-row{
      display: grid;
      grid-template-columns: 1fr;
      gap: 6px;
    }
    .bar-top{
      display:flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      font-size: 12px;
      color: rgba(255,255,255,.72);
      font-variant-numeric: tabular-nums;
    }
    .bar-top .k{ font-weight: 600; }
    .bar-top .v{ color: rgba(255,255,255,.55); }

    .bar-bg{
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.08);
      overflow: hidden;
      position: relative;
    }
    .bar-fill{
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--accent), rgba(96,165,250,1));
      transition: width 1.2s cubic-bezier(0.16, 1, 0.3, 1);
    }
    .bar-bg:hover{
      border-color: rgba(255,255,255,.18);
    }

    /* Ring chart */
    .ring-wrap{
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 6px 0 2px;
    }
    .ring{
      width: 160px;
      height: 160px;
      border-radius: 50%;
      background:
        conic-gradient(var(--accent) 0deg, var(--accent) var(--deg, 0deg), rgba(255,255,255,.10) var(--deg, 0deg), rgba(255,255,255,.10) 360deg);
      position: relative;
      display:grid;
      place-items:center;
      transition: filter .2s ease;
    }
    .ring:hover{ filter: brightness(1.08); }
    .ring::after{
      content:"";
      width: 118px;
      height: 118px;
      border-radius: 50%;
      background: rgba(7,7,10,.95);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
      position:absolute;
    }
    .ring-center{
      position: relative;
      z-index: 1;
      text-align:center;
      display:grid;
      gap: 4px;
    }
    .ring-center .pct{
      font-family: var(--font-display);
      font-size: 34px;
      letter-spacing: var(--tracking-tight);
      font-weight: 700;
      color: #fff;
      font-variant-numeric: tabular-nums;
      line-height: 1;
    }
    .ring-center .cap{
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: var(--tracking-wide);
      color: rgba(255,255,255,.55);
      font-weight: 700;
    }

    /* Navigation Overlay */
    .nav-hint{
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      color: rgba(255,255,255,.35);
      z-index: 10;
      pointer-events: none;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    /* Top nav */
    .topnav{
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 100;
      background: rgba(7,7,10,0.80);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
    }
    .topnav .row{
      max-width: var(--max);
      margin: 0 auto;
      padding: 16px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
    }
    .back{
      color: var(--text);
      text-decoration: none;
      font-size: 14px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .topmeta{
      font-size: 12px;
      color: rgba(255,255,255,0.45);
      text-transform: uppercase;
      letter-spacing: var(--tracking-wide);
      font-weight: 700;
    }

    /* Minor helper */
    .pad-top{ padding-top: 84px; }

    @media (max-width: 900px){
      .content-wrap{ grid-template-columns: 1fr; gap: 28px; }
      section{ height: auto; min-height: 100vh; padding: 80px 22px 40px; }
      .topnav .row{ padding: 14px 22px; }
      .narrative h2{ font-size: 38px; }
      .number{ font-size: 54px; }
      .visual-stack{ padding: 26px; min-height: 320px; }
      .viz-grid{ grid-template-columns: 1fr; }
      .ring{ width: 150px; height: 150px; }
      .ring::after{ width: 112px; height: 112px; }
    }

    @media (prefers-reduced-motion: reduce){
      .snap-container{ scroll-behavior: auto; }
      .bar-fill{ transition: none; }
    }
  </style>
</head>

<body>
  <nav class="topnav">
    <div class="row">
      <a href="index.html" class="back">
        <span style="font-size: 18px;">←</span> Back to Portfolio
      </a>
      <div class="topmeta">Deep Dive: Analysis & Outcomes</div>
    </div>
  </nav>

  <div class="nav-hint">Scroll down for next analysis ↓</div>

  <div class="snap-container">

    <section id="os-rebuild" class="pad-top">
      <div class="content-wrap">
        <div class="narrative">
          <span class="badge">Governance & Forensic Audit</span>
          <h2>Operating System Rebuild</h2>
          <p>Stabilized a legacy civic organization by identifying systemic knowledge loss. I performed a forensic audit of physical and digital materials, categorizing them into actionable compliance, financial, and program sets to restore organizational memory.</p>
          <ul>
            <li>Confirmed control of critical Gmail and CRM systems.</li>
            <li>Enforced "Owner Presence" rules for project documentation.</li>
            <li>Instituted weekly executive logs to demonstrate leadership outcomes.</li>
          </ul>
        </div>

        <div class="visual-stack">
          <div class="stat-row">
            <span class="number" data-val="100">0</span><span class="number">%</span>
            <span class="label">Systemic Stabilization</span>
          </div>

          <div class="viz-grid">
            <div class="viz-card"
                 data-tip-title="Compliance Recovery"
                 data-tip-body="Restored administrative control and documentation integrity. This reflects immediate stabilization of the operating baseline.">
              <div class="viz-title">
                <div class="name">Bar Graph</div>
                <div class="meta">Hover bars</div>
              </div>

              <div class="bar-chart" data-chart="bars">
                <div class="bar-row">
                  <div class="bar-top">
                    <span class="k">Admin Control</span><span class="v">95%</span>
                  </div>
                  <div class="bar-bg" data-metric="Admin Control" data-val="95" data-note="Recovered ownership of mission-critical access (email/drive/accounts).">
                    <div class="bar-fill" data-width="95%"></div>
                  </div>
                </div>

                <div class="bar-row">
                  <div class="bar-top">
                    <span class="k">Compliance Hygiene</span><span class="v">90%</span>
                  </div>
                  <div class="bar-bg" data-metric="Compliance Hygiene" data-val="90" data-note="Standardized record keeping and audit-readiness behaviors.">
                    <div class="bar-fill" data-width="90%"></div>
                  </div>
                </div>

                <div class="bar-row">
                  <div class="bar-top">
                    <span class="k">Org Memory</span><span class="v">88%</span>
                  </div>
                  <div class="bar-bg" data-metric="Org Memory" data-val="88" data-note="Rebuilt institutional memory via indexing, tagging, and documented owners.">
                    <div class="bar-fill" data-width="88%"></div>
                  </div>
                </div>
              </div>
            </div>

            <div class="viz-card"
                 data-tip-title="Stabilization Index"
                 data-tip-body="Single-score view of stabilization. Hover the ring to see how the percent is computed at a high level.">
              <div class="viz-title">
                <div class="name">Circle Graph</div>
                <div class="meta">Hover ring</div>
              </div>

              <div class="ring-wrap">
                <div class="ring"
                     data-chart="ring"
                     data-val="95"
                     data-cap="Stabilization"
                     data-note="Composite index: admin control + compliance hygiene + documented ownership.">
                  <div class="ring-center">
                    <div class="pct">0%</div>
                    <div class="cap">Stabilization</div>
                  </div>
                </div>
              </div>

              <p style="font-size: 12px; margin: 0; opacity: 0.65; color: rgba(255,255,255,.70);">
                *Composite of control recovery + documentation enforcement.
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="digital-engine">
      <div class="content-wrap">
        <div class="narrative">
          <span class="badge">Process Intelligence</span>
          <h2>Content & Analytics Engine</h2>
          <p>Transformed manual onboarding and reporting into high-velocity digital workflows. I specialized in deploying automated pipelines that replaced labor-intensive data entry with secure, analytics-driven record management.</p>
          <ul>
            <li>Boosted registration efficiency by 35% via software integration.</li>
            <li>Modernized global multimillion-dollar portfolios across 120+ markets.</li>
            <li>Eliminated 60% of manual data entry through custom deployments.</li>
          </ul>
        </div>

        <div class="visual-stack">
          <div class="stat-row">
            <span class="number" data-val="40">0</span><span class="number">+</span>
            <span class="label">Weekly Staff Hours Saved</span>
          </div>

          <div class="viz-grid">
            <div class="viz-card"
                 data-tip-title="Digitization Velocity"
                 data-tip-body="Breakdown view. Hover each bar to see what drove the lift.">
              <div class="viz-title">
                <div class="name">Bar Graph</div>
                <div class="meta">Hover bars</div>
              </div>

              <div class="bar-chart" data-chart="bars">
                <div class="bar-row">
                  <div class="bar-top">
                    <span class="k">Automation</span><span class="v">92%</span>
                  </div>
                  <div class="bar-bg" data-metric="Automation" data-val="92" data-note="Workflows replaced manual steps and normalized intake.">
                    <div class="bar-fill" data-width="92%"></div>
                  </div>
                </div>

                <div class="bar-row">
                  <div class="bar-top">
                    <span class="k">Throughput</span><span class="v">85%</span>
                  </div>
                  <div class="bar-bg" data-metric="Throughput" data-val="85" data-note="Higher velocity from standard operating rhythm + templates.">
                    <div class="bar-fill" data-width="85%"></div>
                  </div>
                </div>

                <div class="bar-row">
                  <div class="bar-top">
                    <span class="k">Data Integrity</span><span class="v">88%</span>
                  </div>
                  <div class="bar-bg" data-metric="Data Integrity" data-val="88" data-note="Reduced rework via validation + structured fields.">
                    <div class="bar-fill" data-width="88%"></div>
                  </div>
                </div>
              </div>
            </div>

            <div class="viz-card"
                 data-tip-title="Hours Saved"
                 data-tip-body="Ring view of the ‘40+ hours/week’ claim expressed as a normalized score (0–100). Hover for context.">
              <div class="viz-title">
                <div class="name">Circle Graph</div>
                <div class="meta">Hover ring</div>
              </div>

              <div class="ring-wrap">
                <div class="ring"
                     data-chart="ring"
                     data-val="92"
                     data-cap="Savings"
                     data-note="Normalized score: hours saved + repeatability + adoption.">
                  <div class="ring-center">
                    <div class="pct">0%</div>
                    <div class="cap">Savings</div>
                  </div>
                </div>
              </div>

              <p style="font-size: 12px; margin: 0; opacity: 0.65; color: rgba(255,255,255,.70);">
                *Normalized to keep visuals consistent across pages.
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="military-comms">
      <div class="content-wrap">
        <div class="narrative">
          <span class="badge">Strategic Command</span>
          <h2>High-Stakes Narrative Strategy</h2>
          <p>Lead enterprise modernization and secure digital transformation across global theaters for 10K+ personnel. I managed $10M+ portfolios under pressure, ensuring message discipline and mission alignment across general officers and interagency partners.</p>
          <ul>
            <li>Accelerated project delivery by 20% using Agile/PMP frameworks.</li>
            <li>Reduced federal response times by 35% via AI-driven analytics.</li>
            <li>Directed zero-trust security implementations for mission systems.</li>
          </ul>
        </div>

        <div class="visual-stack">
          <div class="stat-row">
            <span class="number" data-val="25">0</span><span class="number">%</span>
            <span class="label">Cycle Time Reduction</span>
          </div>

          <div class="viz-grid">
            <div class="viz-card"
                 data-tip-title="Delivery Under Pressure"
                 data-tip-body="Bars show the drivers behind cycle-time reduction and compliance posture. Hover for detail.">
              <div class="viz-title">
                <div class="name">Bar Graph</div>
                <div class="meta">Hover bars</div>
              </div>

              <div class="bar-chart" data-chart="bars">
                <div class="bar-row">
                  <div class="bar-top">
                    <span class="k">Delivery Speed</span><span class="v">80%</span>
                  </div>
                  <div class="bar-bg" data-metric="Delivery Speed" data-val="80" data-note="Agile cadence + disciplined reporting reduced drag.">
                    <div class="bar-fill" data-width="80%"></div>
                  </div>
                </div>

                <div class="bar-row">
                  <div class="bar-top">
                    <span class="k">Security Posture</span><span class="v">100%</span>
                  </div>
                  <div class="bar-bg" data-metric="Security Posture" data-val="100" data-note="Zero-trust implementation across mission systems.">
                    <div class="bar-fill" data-width="100%"></div>
                  </div>
                </div>

                <div class="bar-row">
                  <div class="bar-top">
                    <span class="k">Process Discipline</span><span class="v">88%</span>
                  </div>
                  <div class="bar-bg" data-metric="Process Discipline" data-val="88" data-note="Lean improvements cut cycle time and reduced rework.">
                    <div class="bar-fill" data-width="88%"></div>
                  </div>
                </div>
              </div>
            </div>

            <div class="viz-card"
                 data-tip-title="Compliance Posture"
                 data-tip-body="Ring depicts security posture as a normalized score. Hover for the driver note.">
              <div class="viz-title">
                <div class="name">Circle Graph</div>
                <div class="meta">Hover ring</div>
              </div>

              <div class="ring-wrap">
                <div class="ring"
                     data-chart="ring"
                     data-val="100"
                     data-cap="Compliance"
                     data-note="Verified by implementation outcomes and governance enforcement.">
                  <div class="ring-center">
                    <div class="pct">0%</div>
                    <div class="cap">Compliance</div>
                  </div>
                </div>
              </div>

              <p style="font-size: 12px; margin: 0; opacity: 0.65; color: rgba(255,255,255,.70);">
                *Shown as normalized score for visual consistency.
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="civic-roadmap">
      <div class="content-wrap">
        <div class="narrative">
          <span class="badge">Economic Vitality</span>
          <h2>Civic Transformation Roadmap</h2>
          <p>Architecting long-range revitalization through ROI-driven execution and cross-sector coalitions. I move organizations from stabilization to a controlled rebuild, integrating capital investment planning with modernized workforce readiness engines.</p>
          <ul>
            <li>Leading district acceleration engines for talent readiness.</li>
            <li>Negotiating public-private partnerships with state and local partners.</li>
            <li>Building systems that outlast leadership cycles.</li>
          </ul>
        </div>

        <div class="visual-stack">
          <div class="stat-row">
            <span class="number" data-val="12">0</span><span class="number">mo</span>
            <span class="label">Strategic Launch Cycle</span>
          </div>

          <div class="viz-grid">
            <div class="viz-card"
                 data-tip-title="Stakeholder Trust"
                 data-tip-body="Bars show trust-building components. Hover each bar for the driver note.">
              <div class="viz-title">
                <div class="name">Bar Graph</div>
                <div class="meta">Hover bars</div>
              </div>

              <div class="bar-chart" data-chart="bars">
                <div class="bar-row">
                  <div class="bar-top">
                    <span class="k">Coalition Alignment</span><span class="v">88%</span>
                  </div>
                  <div class="bar-bg" data-metric="Coalition Alignment" data-val="88" data-note="Cross-sector alignment to converge on a single roadmap.">
                    <div class="bar-fill" data-width="88%"></div>
                  </div>
                </div>

                <div class="bar-row">
                  <div class="bar-top">
                    <span class="k">Capital Planning</span><span class="v">80%</span>
                  </div>
                  <div class="bar-bg" data-metric="Capital Planning" data-val="80" data-note="ROI-first sequencing with clear milestones and owners.">
                    <div class="bar-fill" data-width="80%"></div>
                  </div>
                </div>

                <div class="bar-row">
                  <div class="bar-top">
                    <span class="k">Execution Cadence</span><span class="v">85%</span>
                  </div>
                  <div class="bar-bg" data-metric="Execution Cadence" data-val="85" data-note="Operating rhythm reduces ambiguity and sustains momentum.">
                    <div class="bar-fill" data-width="85%"></div>
                  </div>
                </div>
              </div>
            </div>

            <div class="viz-card"
                 data-tip-title="Trust Index"
                 data-tip-body="Ring depicts stakeholder trust as a normalized score. Hover for context.">
              <div class="viz-title">
                <div class="name">Circle Graph</div>
                <div class="meta">Hover ring</div>
              </div>

              <div class="ring-wrap">
                <div class="ring"
                     data-chart="ring"
                     data-val="88"
                     data-cap="Trust"
                     data-note="Composite: coalition alignment + cadence + transparent reporting.">
                  <div class="ring-center">
                    <div class="pct">0%</div>
                    <div class="cap">Trust</div>
                  </div>
                </div>
              </div>

              <p style="font-size: 12px; margin: 0; opacity: 0.65; color: rgba(255,255,255,.70);">
                *Composite index, normalized for visuals.
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>

  </div>

  <div class="tip" id="tip" role="status" aria-live="polite">
    <div class="t-head" id="tipHead"></div>
    <div class="t-body" id="tipBody"></div>
  </div>

  <script>
    const clamp = (n, a, b) => Math.max(a, Math.min(b, n));

    // Tooltip controller
    const tip = document.getElementById('tip');
    const tipHead = document.getElementById('tipHead');
    const tipBody = document.getElementById('tipBody');

    function showTip(title, body, x, y){
      tipHead.textContent = title || '';
      tipBody.textContent = body || '';
      const pad = 14;

      const w = tip.offsetWidth || 260;
      const h = tip.offsetHeight || 90;

      const px = clamp(x + 16, pad, window.innerWidth - w - pad);
      const py = clamp(y + 18, pad, window.innerHeight - h - pad);

      tip.style.left = px + "px";
      tip.style.top = py + "px";
      tip.classList.add('show');
    }
    function hideTip(){ tip.classList.remove('show'); }

    // Reveal + animate charts when section is active
    const observerOptions = { threshold: 0.6 };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (!entry.isIntersecting) return;

        entry.target.classList.add('active');

        // Big number count (idempotent)
        const nums = entry.target.querySelectorAll('.number[data-val]');
        nums.forEach(num => {
          if (num.dataset.animated === "1") return;

          const target = Number(num.getAttribute('data-val'));
          if (!Number.isFinite(target) || target === 0) return;

          num.dataset.animated = "1";

          let current = 0;
          const duration = 900;
          const inc = target / (duration / 16);

          const update = () => {
            current += inc;
            if (current < target) {
              num.innerText = Math.ceil(current);
              requestAnimationFrame(update);
            } else {
              num.innerText = target;
            }
          };
          update();
        });

        // Bar fills
        const fills = entry.target.querySelectorAll('.bar-fill[data-width]');
        fills.forEach(f => {
          f.style.width = f.getAttribute('data-width');
        });

        // Rings
        const rings = entry.target.querySelectorAll('.ring[data-val]');
        rings.forEach(r => {
          if (r.dataset.animated === "1") return;
          r.dataset.animated = "1";

          const targetPct = clamp(Number(r.getAttribute('data-val')) || 0, 0, 100);
          const degTarget = targetPct * 3.6;

          let deg = 0;
          const step = Math.max(3, degTarget / 45);

          const pctEl = r.querySelector('.pct');
          const capEl = r.querySelector('.cap');
          const capText = r.getAttribute('data-cap') || capEl?.textContent || '';

          if (capEl) capEl.textContent = capText;

          const tick = () => {
            deg = Math.min(deg + step, degTarget);
            r.style.setProperty('--deg', deg.toFixed(1) + "deg");

            const shown = Math.round(deg / 3.6);
            if (pctEl) pctEl.textContent = shown + "%";

            if (deg < degTarget) requestAnimationFrame(tick);
            else if (pctEl) pctEl.textContent = targetPct + "%";
          };
          tick();
        });
      });
    }, observerOptions);

    document.querySelectorAll('section').forEach(section => observer.observe(section));

    // Hover interactions: bars + rings + cards
    function bindHover(){
      // Bars
      document.querySelectorAll('.bar-bg').forEach(el => {
        el.addEventListener('mousemove', (e) => {
          const metric = el.getAttribute('data-metric') || 'Metric';
          const val = el.getAttribute('data-val') || '';
          const note = el.getAttribute('data-note') || '';
          showTip(metric + " • " + val + "%", note, e.clientX, e.clientY);
        }, { passive: true });

        el.addEventListener('mouseleave', hideTip);
      });

      // Rings
      document.querySelectorAll('.ring').forEach(el => {
        el.addEventListener('mousemove', (e) => {
          const cap = el.getAttribute('data-cap') || 'Index';
          const val = el.getAttribute('data-val') || '';
          const note = el.getAttribute('data-note') || '';
          showTip(cap + " • " + val + "%", note, e.clientX, e.clientY);
        }, { passive: true });

        el.addEventListener('mouseleave', hideTip);
      });

      // Cards (optional richer context)
      document.querySelectorAll('.viz-card[data-tip-title]').forEach(el => {
        el.addEventListener('mousemove', (e) => {
          const title = el.getAttribute('data-tip-title') || '';
          const body = el.getAttribute('data-tip-body') || '';
          // only show if user isn't currently hovering a bar/ring (which would override)
          const isOverBar = e.target.closest('.bar-bg');
          const isOverRing = e.target.closest('.ring');
          if (!isOverBar && !isOverRing) showTip(title, body, e.clientX, e.clientY);
        }, { passive: true });

        el.addEventListener('mouseleave', hideTip);
      });
    }
    bindHover();

    // Hide tooltip if user scrolls
    document.querySelector('.snap-container').addEventListener('scroll', hideTip, { passive: true });
    window.addEventListener('blur', hideTip);
  </script>
</body>
</html>
